<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDF Pages Viewer</title>
  <style>
    body {
      background: #f4f4f4;
      font-family: sans-serif;
      display: flex;
      flex-wrap: wrap;
      position: relative;
      justify-content: center;
      margin: 8px;
    }
    img {
      width: 100%; 
      height: auto;
      margin-top: 10px; 
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }
  </style>
  <style>
    #progress-bar-container {
      position: fixed;
      left: 8px;
      bottom: 0;
      width: calc(100% - 16px);
      height: 8px;
      background: rgba(0,0,0,0.08);
      z-index: 1000;
    }
    #progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #2dc27c, #2de891);
      border-radius: 8px;
      transition: width 0.2s;
    }
  </style>
</head>
<body>
  <img src="images/page_35.jpg" alt="Page 35">
  <img src="images/page_36.jpg" alt="Page 36">
  <img src="images/page_37.jpg" alt="Page 37">
  <img src="images/page_38.jpg" alt="Page 38">
  <img src="images/page_39.jpg" alt="Page 39">
  <img src="images/page_40.jpg" alt="Page 40">
  <img src="images/page_41.jpg" alt="Page 41">
  <img src="images/page_42.jpg" alt="Page 42">
  <img src="images/page_43.jpg" alt="Page 43">
  <img src="images/page_44.jpg" alt="Page 44">
  <img src="images/page_45.jpg" alt="Page 45">
  <img src="images/page_46.jpg" alt="Page 46">
  <img src="images/page_47.jpg" alt="Page 47">
  <img src="images/page_48.jpg" alt="Page 48">
  <img src="images/page_49.jpg" alt="Page 49">
  <img src="images/page_50.jpg" alt="Page 50">
  <img src="images/page_51.jpg" alt="Page 51">
  <img src="images/page_52.jpg" alt="Page 52">
  <img src="images/page_53.jpg" alt="Page 53">
  <img src="images/page_54.jpg" alt="Page 54">
  <img src="images/page_55.jpg" alt="Page 55">
  <img src="images/page_56.jpg" alt="Page 56">
  <img src="images/page_57.jpg" alt="Page 57">
  <img src="images/page_58.jpg" alt="Page 58">
  <img src="images/page_59.jpg" alt="Page 59">
  <img src="images/page_60.jpg" alt="Page 60">
  <img src="images/page_61.jpg" alt="Page 61">
  <img src="images/page_62.jpg" alt="Page 62">
  <img src="images/page_63.jpg" alt="Page 63">
  <img src="images/page_64.jpg" alt="Page 64">
  <img src="images/page_65.jpg" alt="Page 65">
  <img src="images/page_66.jpg" alt="Page 66">
</body>
<div id="progress-bar-container">
  <div id="progress-bar"></div>
  <div id="progress-tooltip" style="position:absolute;left:0;transform:translateY(-120%);bottom:-150%;background:#222;color:#fff;padding:4px 8px;border-radius:6px;font-size:12px;white-space:nowrap;pointer-events:none;z-index:1002;">0%</div>
</div>
<!-- Quiz Button -->
<div style="width:100%;display:flex;justify-content:center;margin:24px 0 16px 0;position:relative;z-index:1001;">
  <a href="quiz.html" style="background:linear-gradient(90deg,#2dc27c,#2de891);color:white;padding:16px 32px;border:none;border-radius:8px;font-size:1.2em;font-weight:bold;text-decoration:none;box-shadow:0 2px 8px rgba(0,0,0,0.15);transition:background 0.2s;cursor:pointer;">Take the Quiz</a>
</div>
<script type="module">
    import {saveData, loadData, renderMoqrarat, updateProgress, getMoqrar} from '/firebase.js';
              
  let lastSentProgress = null;
  function getDateFromPath() {
    // Extracts the date from the folder name in the URL (e.g., /pages/10-07-2025/)
    const match = window.location.pathname.match(/pages\/([^\/]+)\//);
    return match ? match[1] : null;
  }
  function saveProgress(progress) {
    const date = getDateFromPath();
    if (!date) return;
    // Only send if progress changed by at least 1%
    if (lastSentProgress !== null && Math.abs(progress - lastSentProgress) < 0.01) return;
    lastSentProgress = progress;
    updateProgress(progress, date);
  }
  function updateProgressBar() {
    const scrollTop = window.scrollY || document.documentElement.scrollTop;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const progress = docHeight > 0 ? (scrollTop / docHeight) : 0;
    document.getElementById('progress-bar').style.width = (progress * 100) + '%';
    // Tooltip update
    const tooltip = document.getElementById('progress-tooltip');
    if (tooltip) {
      tooltip.textContent = Math.round(progress * 100) + '%';
      tooltip.style.left = `calc(${progress * 100}% - 20px)`;
    }
    saveProgress(progress);
  }
  function initProgress(){
    const date = getDateFromPath();
    if (!date) return;
    getMoqrar(date).then(moqrar => {
      if (moqrar && moqrar.progress) {
        const progress = parseFloat(moqrar.progress);
        document.getElementById('progress-bar').style.width = (progress * 100) + '%';
        // Tooltip update
        const tooltip = document.getElementById('progress-tooltip');
        if (tooltip) {
          tooltip.textContent = Math.round(progress * 100) + '%';
          tooltip.style.left = `calc(${progress * 100}% - 20px)`;
        }
        lastSentProgress = progress;
        // Scroll to the saved progress position
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        if (docHeight > 0) {
            window.scrollTo(0, progress * docHeight);
        }
      }
    });
  }
  window.addEventListener('scroll', updateProgressBar);
  window.addEventListener('resize', updateProgressBar);
  document.addEventListener('DOMContentLoaded', initProgress);
</script>
</html>
